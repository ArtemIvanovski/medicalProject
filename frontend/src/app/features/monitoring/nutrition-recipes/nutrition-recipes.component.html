<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-lg-2 col-md-3">
            <div class="nutrition-sidebar">
                <h5>Питание</h5>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/patient/monitoring/nutrition">
                            <i class="fas fa-chart-line"></i> Обзор
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/patient/monitoring/nutrition/search">
                            <i class="fas fa-search"></i> Поиск продуктов
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/patient/monitoring/nutrition/my-products">
                            <i class="fas fa-user"></i> Мои продукты
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/patient/monitoring/nutrition/products/create">
                            <i class="fas fa-plus"></i> Создать продукт
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" routerLink="/patient/monitoring/nutrition/recipes">
                            <i class="fas fa-book"></i> Рецепты
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/patient/monitoring/nutrition/diary">
                            <i class="fas fa-calendar"></i> Дневник питания
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" routerLink="/patient/monitoring/nutrition/analytics">
                            <i class="fas fa-chart-bar"></i> Аналитика
                        </a>
                    </li>
                </ul>
            </div>
        </div>


        <!-- Main Content -->
        <div class="col-lg-10 col-md-9">
            <!-- Header Section -->
            <div class="recipes-header mb-4">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h2><i class="fas fa-book me-2"></i>Мои рецепты</h2>
                        <p class="text-muted">Создавайте и управляйте своими любимыми рецептами</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-primary btn-lg" (click)="openCreateModal()">
                            <i class="fas fa-plus me-2"></i>
                            Создать рецепт
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row mb-4">
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-icon recipes">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ getTotalRecipes() }}</h3>
                            <p>Всего рецептов</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-icon favorites">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ getGroupRecipes() }}</h3>
                            <p>На компанию</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-icon quick">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ getQuickRecipes() }}</h3>
                            <p>Быстрые</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-icon calories">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-content">
                            <h3>{{ formatNumber(getAverageCalories()) }}</h3>
                            <p>Средние ккал</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="filters-section mb-4" *ngIf="recipes.length > 0">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="search-wrapper">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text"
                                   class="form-control search-input"
                                   placeholder="Поиск рецептов по названию или описанию..."
                                   [(ngModel)]="searchFilter"
                                   (input)="onSearchChange()">
                            <button *ngIf="searchFilter"
                                    class="btn btn-sm btn-outline-secondary clear-btn"
                                    (click)="searchFilter = ''; onSearchChange()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="sort-controls">
                            <select class="form-select" (change)="onSortChange($event)">
                                <option value="created_at_desc">Сначала новые</option>
                                <option value="created_at_asc">Сначала старые</option>
                                <option value="name_asc">По названию А-Я</option>
                                <option value="name_desc">По названию Я-А</option>
                                <option value="calories_desc">Больше калорий</option>
                                <option value="calories_asc">Меньше калорий</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div *ngIf="isLoading" class="text-center py-5">
                <div class="spinner-border spinner-border-lg" role="status"></div>
                <p class="mt-3 text-muted">Загрузка рецептов...</p>
            </div>

            <!-- Error State -->
            <div *ngIf="error && !isLoading" class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                {{ error }}
                <button class="btn btn-outline-danger btn-sm ms-3" (click)="loadRecipes()">
                    Попробовать снова
                </button>
            </div>

            <!-- Empty State -->
            <div *ngIf="!isLoading && !error && recipes.length === 0" class="empty-state">
                <div class="empty-state-content">
                    <div class="empty-state-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h4>У вас пока нет рецептов</h4>
                    <p>Создайте свой первый рецепт и начните готовить с удовольствием!</p>
                    <button class="btn btn-primary btn-lg" (click)="openCreateModal()">
                        <i class="fas fa-plus me-2"></i>
                        Создать первый рецепт
                    </button>
                </div>
            </div>

            <!-- No Results after Filter -->
            <div *ngIf="!isLoading && !error && recipes.length > 0 && filteredRecipes.length === 0" class="no-results">
                <div class="no-results-content">
                    <div class="no-results-icon">
                        <i class="fas fa-search-minus"></i>
                    </div>
                    <h4>Рецепты не найдены</h4>
                    <p>По вашему запросу "<strong>{{ searchFilter }}</strong>" рецепты не найдены.</p>
                    <button class="btn btn-outline-primary" (click)="searchFilter = ''; onSearchChange()">
                        <i class="fas fa-times me-1"></i>
                        Очистить поиск
                    </button>
                </div>
            </div>

            <!-- Recipes Grid -->
            <div *ngIf="!isLoading && !error && filteredRecipes.length > 0" class="recipes-grid">
                <div class="row">
                    <div class="col-lg-4 col-md-6 mb-4" *ngFor="let recipe of filteredRecipes">
                        <div class="recipe-card" (click)="viewRecipe(recipe)">
                            <!-- Recipe Image -->
                            <div class="recipe-image">
                                <img *ngIf="recipe.image_url"
                                     [src]="recipe.image_url"
                                     [alt]="recipe.name"
                                     class="recipe-img">
                                <div *ngIf="!recipe.image_url" class="recipe-placeholder">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="recipe-stats-overlay">
                                    <div class="servings-badge">
                                        <i class="fas fa-users me-1"></i>
                                        {{ recipe.servings }}
                                    </div>
                                </div>
                                <div class="recipe-actions-overlay">
                                    <button class="btn btn-sm btn-light action-btn"
                                            (click)="$event.stopPropagation(); editRecipe(recipe)"
                                            title="Редактировать">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-light action-btn"
                                            (click)="$event.stopPropagation(); addRecipeToDay(recipe)"
                                            title="В дневник">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button class="btn btn-sm btn-light action-btn text-danger"
                                            (click)="$event.stopPropagation(); confirmDelete(recipe)"
                                            title="Удалить">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Recipe Content -->
                            <div class="recipe-content">
                                <h5 class="recipe-title">{{ recipe.name }}</h5>

                                <div class="recipe-description" *ngIf="recipe.description">
                                    <p>{{ recipe.description | slice:0:60 }}<span
                                            *ngIf="recipe.description.length > 60">...</span></p>
                                </div>

                                <!-- Nutrition Info -->
                                <div class="recipe-nutrition">
                                    <div class="nutrition-item calories">
                                        <span class="nutrition-value">{{ formatNumber(recipe.calories_per_100g) }}</span>
                                        <span class="nutrition-label">ккал</span>
                                    </div>
                                    <div class="nutrition-item protein">
                                        <span class="nutrition-value">{{ formatNumber(recipe.protein_per_100g) }}
                                            г</span>
                                        <span class="nutrition-label">Б</span>
                                    </div>
                                    <div class="nutrition-item fat">
                                        <span class="nutrition-value">{{ formatNumber(recipe.fat_per_100g) }}г</span>
                                        <span class="nutrition-label">Ж</span>
                                    </div>
                                    <div class="nutrition-item carbs">
                                        <span class="nutrition-value">{{ formatNumber(recipe.carbohydrate_per_100g) }}
                                            г</span>
                                        <span class="nutrition-label">У</span>
                                    </div>
                                </div>

                                <!-- Recipe Meta -->
                                <div class="recipe-meta">
                                    <div class="recipe-meta-item">
                                        <i class="fas fa-clock me-1"></i>
                                        {{ recipe.created_at | date:'dd.MM.yyyy' }}
                                    </div>
                                    <div class="recipe-meta-item">
                                        <i class="fas fa-weight me-1"></i>
                                        {{ formatNumber(recipe.total_weight) }}г
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Recipe Modal -->
<div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
    <div class="modern-modal large-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h4 class="modal-title">
                <i class="fas fa-plus me-2"></i>
                Создать новый рецепт
            </h4>
            <button type="button" class="modal-close-btn" (click)="closeCreateModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form [formGroup]="createRecipeForm" (ngSubmit)="createRecipe()">
            <div class="modal-body">
                <!-- Basic Info -->
                <div class="form-section">
                    <h6 class="section-title">Основная информация</h6>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label class="form-label required">Название рецепта</label>
                                <input type="text"
                                       class="form-control"
                                       formControlName="name"
                                       placeholder="Введите название рецепта">
                                <div *ngIf="createRecipeForm.get('name')?.invalid && createRecipeForm.get('name')?.touched"
                                     class="form-error">
                                    Введите название рецепта (минимум 2 символа)
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required">Порций</label>
                                <input type="number"
                                       class="form-control"
                                       formControlName="servings"
                                       min="1"
                                       placeholder="1">
                                <div *ngIf="createRecipeForm.get('servings')?.invalid && createRecipeForm.get('servings')?.touched"
                                     class="form-error">
                                    Укажите количество порций (минимум 1)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Описание</label>
                        <textarea class="form-control"
                                  formControlName="description"
                                  rows="3"
                                  placeholder="Опишите рецепт, способ приготовления или особенности"></textarea>
                    </div>

                    <!-- Image Upload -->
                    <div class="form-group">
                        <label class="form-label">Изображение рецепта</label>
                        <div class="image-upload-area">
                            <div *ngIf="!imagePreview" class="upload-placeholder" (click)="fileInput.click()">
                                <i class="fas fa-camera fa-2x mb-2"></i>
                                <p>Нажмите, чтобы добавить фото рецепта</p>
                                <small class="text-muted">Поддерживаются форматы JPG, PNG</small>
                            </div>
                            <div *ngIf="imagePreview" class="image-preview">
                                <img [src]="imagePreview" alt="Preview">
                                <button type="button" class="btn btn-sm btn-danger remove-image-btn"
                                        (click)="removeImage()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <input #fileInput type="file" accept="image/*" (change)="onImageSelected($event)"
                                   style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Ingredients -->
                <div class="form-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="section-title mb-0">Ингредиенты</h6>
                        <button type="button"
                                class="btn btn-outline-primary btn-sm"
                                (click)="addIngredient(createIngredientsFormArray)">
                            <i class="fas fa-plus me-1"></i>
                            Добавить
                        </button>
                    </div>

                    <!-- Search for ingredients -->
                    <div class="ingredient-search-section mb-3">
                        <label class="form-label">Поиск продуктов</label>
                        <input type="text"
                               class="form-control"
                               placeholder="Введите название продукта для поиска..."
                               [(ngModel)]="searchQuery"
                               (input)="onIngredientSearch($event)"
                               [ngModelOptions]="{standalone: true}">

                        <!-- Search Results -->
                        <div *ngIf="showSearchResults && searchResults" class="search-results mt-2">
                            <div class="search-results-header">Результаты поиска:</div>
                            <div class="search-results-list">
                                <div *ngFor="let product of searchResults.products.slice(0, 3)"
                                     class="search-result-item"
                                     (click)="selectIngredient(product, 'product')">
                                    <div class="result-content">
                                        <div class="result-name">{{ product.name }}</div>
                                        <div class="result-meta">{{ formatNumber(product.calories) }} ккал/100г</div>
                                    </div>
                                </div>
                                <div *ngFor="let product of searchResults.user_products.slice(0, 2)"
                                     class="search-result-item"
                                     (click)="selectIngredient(product, 'user_product')">
                                    <div class="result-content">
                                        <div class="result-name">
                                            {{ product.name }}
                                            <span class="badge bg-secondary ms-1">Мой</span>
                                        </div>
                                        <div class="result-meta">{{ formatNumber(product.calories) }} ккал/100г</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div formArrayName="ingredients" class="ingredients-list">
                        <div *ngFor="let ingredient of createIngredientsFormArray.controls; let i = index"
                             [formGroupName]="i"
                             class="ingredient-item">
                            <div class="ingredient-header">
                                <span class="ingredient-number">{{ i + 1 }}.</span>
                                <button type="button"
                                        class="btn btn-sm btn-outline-danger"
                                        (click)="removeIngredient(createIngredientsFormArray, i)"
                                        [disabled]="createIngredientsFormArray.length <= 1">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label required">Продукт</label>
                                    <input type="text"
                                           class="form-control"
                                           formControlName="product_name"
                                           placeholder="Выберите продукт из поиска"
                                           readonly>
                                    <small class="text-muted">Используйте поиск выше для выбора продукта</small>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label required">Количество</label>
                                    <input type="number"
                                           class="form-control"
                                           formControlName="amount"
                                           min="0.1"
                                           step="0.1"
                                           placeholder="100">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Единица</label>
                                    <select class="form-select" formControlName="unit">
                                        <option value="g">граммы</option>
                                        <option value="ml">миллилитры</option>
                                        <option value="pieces">штуки</option>
                                        <option value="tbsp">ст. ложки</option>
                                        <option value="tsp">ч. ложки</option>
                                        <option value="cup">стаканы</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
                    <i class="fas fa-times me-1"></i>
                    Отмена
                </button>
                <button type="submit"
                        class="btn btn-primary"
                        [disabled]="createRecipeForm.invalid">
                    <i class="fas fa-save me-1"></i>
                    Создать рецепт
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Recipe Modal -->
<div *ngIf="showEditModal && selectedRecipe" class="modal-overlay" (click)="closeEditModal()">
    <div class="modern-modal large-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h4 class="modal-title">
                <i class="fas fa-edit me-2"></i>
                Редактировать рецепт: {{ selectedRecipe.name }}
            </h4>
            <button type="button" class="modal-close-btn" (click)="closeEditModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form [formGroup]="editRecipeForm" (ngSubmit)="updateRecipe()">
            <div class="modal-body">
                <!-- Single Column Layout -->
                <!-- Main Information Section -->
                <div class="form-section">
                    <h6 class="section-title">Основная информация</h6>

                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label class="form-label required">Название рецепта</label>
                                <input type="text"
                                       class="form-control"
                                       formControlName="name"
                                       placeholder="Введите название рецепта">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label required">Порций</label>
                                <input type="number"
                                       class="form-control"
                                       formControlName="servings"
                                       min="1">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Описание</label>
                        <textarea class="form-control"
                                  formControlName="description"
                                  rows="3"></textarea>
                    </div>
                </div>

                <!-- Ingredients Section -->
                <div class="form-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="section-title mb-0">Ингредиенты</h6>
                        <button type="button"
                                class="btn btn-outline-primary btn-sm"
                                (click)="addIngredient(editIngredientsFormArray)">
                            <i class="fas fa-plus me-1"></i>
                            Добавить
                        </button>
                    </div>

                    <div formArrayName="ingredients" class="ingredients-list">
                        <div *ngFor="let ingredient of editIngredientsFormArray.controls; let i = index"
                             [formGroupName]="i"
                             class="ingredient-item">
                            <div class="ingredient-header">
                                <span class="ingredient-number">{{ i + 1 }}.</span>
                                <button type="button"
                                        class="btn btn-sm btn-outline-danger"
                                        (click)="removeIngredient(editIngredientsFormArray, i)"
                                        [disabled]="editIngredientsFormArray.length <= 1">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Продукт</label>
                                    <input type="text"
                                           class="form-control"
                                           formControlName="product_name"
                                           readonly>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Количество</label>
                                    <input type="number"
                                           class="form-control"
                                           formControlName="amount"
                                           min="0.1"
                                           step="0.1">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Единица</label>
                                    <select class="form-select" formControlName="unit">
                                        <option value="g">граммы</option>
                                        <option value="ml">миллилитры</option>
                                        <option value="pieces">штуки</option>
                                        <option value="tbsp">ст. ложки</option>
                                        <option value="tsp">ч. ложки</option>
                                        <option value="cup">стаканы</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Upload Section -->
                <div class="form-section">
                    <h6 class="section-title">Изображение рецепта</h6>
                    <div class="image-upload-area">
                        <div *ngIf="!imagePreview && !selectedRecipe?.image_url" class="upload-placeholder"
                             (click)="editFileInput.click()">
                            <i class="fas fa-camera fa-2x mb-2"></i>
                            <p>Нажмите, чтобы добавить фото рецепта</p>
                        </div>
                        <div *ngIf="imagePreview || selectedRecipe?.image_url" class="image-preview">
                            <img [src]="imagePreview || selectedRecipe.image_url" alt="Recipe image">
                            <button type="button" class="btn btn-sm btn-danger remove-image-btn"
                                    (click)="removeImage()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <input #editFileInput type="file" accept="image/*" (change)="onImageSelected($event)"
                               style="display: none;">
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
                    <i class="fas fa-times me-1"></i>
                    Отмена
                </button>
                <button type="submit"
                        class="btn btn-primary"
                        [disabled]="editRecipeForm.invalid">
                    <i class="fas fa-save me-1"></i>
                    Сохранить изменения
                </button>
            </div>
        </form>
    </div>
</div>

<!-- View Recipe Modal -->
<div *ngIf="showViewModal && selectedRecipe" class="modal-overlay" (click)="closeViewModal()">
    <div class="modern-modal large-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h4 class="modal-title">
                <i class="fas fa-eye me-2"></i>
                {{ selectedRecipe.name }}
            </h4>
            <button type="button" class="modal-close-btn" (click)="closeViewModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body">
            <div class="recipe-view">
                <!-- Recipe Image -->
                <div *ngIf="selectedRecipe.image_url" class="recipe-view-image mb-4">
                    <img [src]="selectedRecipe.image_url" [alt]="selectedRecipe.name" class="recipe-view-img">
                </div>

                <!-- Recipe Info -->
                <div class="recipe-info-section mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item">
                                <i class="fas fa-users me-2"></i>
                                <strong>Порций:</strong> {{ selectedRecipe.servings }}
                            </div>
                            <div class="info-item">
                                <i class="fas fa-weight me-2"></i>
                                <strong>Общий вес:</strong> {{ formatNumber(selectedRecipe.total_weight) }}г
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item">
                                <i class="fas fa-calendar me-2"></i>
                                <strong>Создан:</strong> {{ selectedRecipe.created_at | date:'dd.MM.yyyy HH:mm' }}
                            </div>
                            <div class="info-item">
                                <i class="fas fa-edit me-2"></i>
                                <strong>Изменен:</strong> {{ selectedRecipe.updated_at | date:'dd.MM.yyyy HH:mm' }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div *ngIf="selectedRecipe.description" class="recipe-description-section mb-4">
                    <h6><i class="fas fa-align-left me-2"></i>Описание</h6>
                    <p>{{ selectedRecipe.description }}</p>
                </div>

                <!-- Nutrition Information -->
                <div class="recipe-nutrition-section mb-4">
                    <h6><i class="fas fa-chart-pie me-2"></i>Пищевая ценность на 100г</h6>
                    <div class="nutrition-grid">
                        <div class="nutrition-card calories">
                            <div class="nutrition-value">{{ formatNumber(selectedRecipe.calories_per_100g) }}</div>
                            <div class="nutrition-label">ккал</div>
                        </div>
                        <div class="nutrition-card protein">
                            <div class="nutrition-value">{{ formatNumber(selectedRecipe.protein_per_100g) }}г</div>
                            <div class="nutrition-label">Белки</div>
                        </div>
                        <div class="nutrition-card fat">
                            <div class="nutrition-value">{{ formatNumber(selectedRecipe.fat_per_100g) }}г</div>
                            <div class="nutrition-label">Жиры</div>
                        </div>
                        <div class="nutrition-card carbs">
                            <div class="nutrition-value">{{ formatNumber(selectedRecipe.carbohydrate_per_100g) }}г</div>
                            <div class="nutrition-label">Углеводы</div>
                        </div>
                    </div>
                </div>

                <!-- Ingredients List -->
                <div *ngIf="selectedRecipe.ingredients && selectedRecipe.ingredients.length > 0"
                     class="ingredients-section">
                    <h6><i class="fas fa-list me-2"></i>Ингредиенты</h6>
                    <div class="ingredients-view-list">
                        <div *ngFor="let ingredient of selectedRecipe.ingredients; let i = index"
                             class="ingredient-view-item">
                            <div class="ingredient-info">
                                <div class="ingredient-image">
                                    <img *ngIf="ingredient.product_info?.image_url"
                                         [src]="ingredient.product_info?.image_url"
                                         [alt]="ingredient.product_name"
                                         class="ingredient-img">
                                    <div *ngIf="!ingredient.product_info?.image_url" class="ingredient-placeholder">
                                        <i class="fas fa-apple-alt"></i>
                                    </div>
                                </div>
                                <div class="ingredient-details">
                                    <div class="ingredient-name">{{ ingredient.product_name }}</div>
                                    <div class="ingredient-amount">{{ formatNumber(ingredient.amount) }} {{ ingredient.unit }}</div>
                                    <div *ngIf="ingredient.product_info" class="ingredient-nutrition">
                                        <span>{{ formatNumber(ingredient.product_info.calories) }} ккал/100г</span>
                                        <span class="ms-2">Б: {{ formatNumber(ingredient.product_info.protein) }}
                                            г</span>
                                        <span class="ms-2">Ж: {{ formatNumber(ingredient.product_info.fat) }}г</span>
                                        <span class="ms-2">У: {{ formatNumber(ingredient.product_info.carbohydrate) }}
                                            г</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeViewModal()">
                <i class="fas fa-arrow-left me-1"></i>
                Назад
            </button>
            <button type="button" class="btn btn-outline-primary" (click)="editRecipe(selectedRecipe)">
                <i class="fas fa-edit me-1"></i>
                Редактировать
            </button>
            <button type="button" class="btn btn-primary" (click)="addRecipeToDay(selectedRecipe)">
                <i class="fas fa-plus me-1"></i>
                Добавить в дневник
            </button>
        </div>
    </div>
</div>

<div *ngIf="showDeleteModal && selectedRecipe" class="modal-overlay" (click)="closeDeleteModal()">
    <div class="delete-modal" (click)="$event.stopPropagation()">
        <div class="delete-modal-content">
            <div class="delete-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h5>Удалить рецепт?</h5>
            <p>Вы уверены, что хотите удалить рецепт "<strong>{{ selectedRecipe.name }}</strong>"?</p>
            <p class="text-muted">Это действие нельзя отменить.</p>

            <div class="delete-actions">
                <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">
                    Отмена
                </button>
                <button type="button" class="btn btn-danger" (click)="deleteRecipe()">
                    <i class="fas fa-trash me-1"></i>
                    Удалить рецепт
                </button>
            </div>
        </div>
    </div>
</div>